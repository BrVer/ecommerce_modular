# frozen_string_literal: true

module Orders
  module PlaceOrder
    class Action
      include ::Callable

      def initialize(user_id, order_lines_params)
        @user_id = user_id
        @order_lines_params = order_lines_params
      end

      # TODO: use UUID generated by FE to identify an order,
      # this way we can implement the "AddOrderLine" action, which will add an order line to the order,
      # but only if the order is still "placed"
      def call
        Order.create!(user_id: user_id, state: :placed, order_lines_attributes: order_lines_params).tap do |order|
          Publisher.broadcast('order_placed', OrderPresenter.new(order).attributes)
        end
      end

      private

      attr_reader :user_id, :order_lines_params
    end
  end
end
